# =============================================================================
# Authentik Blueprint â€” Applications
# Registers each service as an Authentik application (appears in the portal).
# Applied automatically on startup.
# =============================================================================
version: 1
metadata:
  name: Superbox Applications
  labels:
    blueprints.goauthentik.io/instantiate: "true"

entries:
  # ---------------------------------------------------------------------------
  # Grafana
  # ---------------------------------------------------------------------------
  - model: authentik_core.application
    state: present
    identifiers:
      slug: grafana
    attrs:
      name: Grafana
      slug: grafana
      provider: !Find [authentik_providers_oauth2.oauth2provider, [name, Grafana Provider]]
      meta_launch_url: !Format ["https://grafana.%s", !Env "DOMAIN"]
      meta_description: Metrics dashboards and alerting
      meta_icon: https://raw.githubusercontent.com/grafana/grafana/main/public/img/grafana_icon.svg
      group: Monitoring
      policy_engine_mode: any
      open_in_new_tab: true

  # ---------------------------------------------------------------------------
  # Portainer
  # ---------------------------------------------------------------------------
  - model: authentik_core.application
    state: present
    identifiers:
      slug: portainer
    attrs:
      name: Portainer
      slug: portainer
      provider: !Find [authentik_providers_proxy.proxyprovider, [name, Portainer Forward Auth]]
      meta_launch_url: !Format ["https://portainer.%s", !Env "DOMAIN"]
      meta_description: Docker container management
      group: Management
      policy_engine_mode: any
      open_in_new_tab: true

  # ---------------------------------------------------------------------------
  # FileBrowser
  # ---------------------------------------------------------------------------
  - model: authentik_core.application
    state: present
    identifiers:
      slug: filebrowser
    attrs:
      name: FileBrowser
      slug: filebrowser
      provider: !Find [authentik_providers_proxy.proxyprovider, [name, FileBrowser Forward Auth]]
      meta_launch_url: !Format ["https://files.%s", !Env "DOMAIN"]
      meta_description: Web-based NAS file manager
      group: Files
      policy_engine_mode: any
      open_in_new_tab: true

  # ---------------------------------------------------------------------------
  # Homepage
  # ---------------------------------------------------------------------------
  - model: authentik_core.application
    state: present
    identifiers:
      slug: homepage
    attrs:
      name: Homepage
      slug: homepage
      provider: !Find [authentik_providers_proxy.proxyprovider, [name, Homepage Forward Auth]]
      meta_launch_url: !Format ["https://%s", !Env "DOMAIN"]
      meta_description: Service dashboard
      group: Management
      policy_engine_mode: any
      open_in_new_tab: true

  # ---------------------------------------------------------------------------
  # Traefik Dashboard
  # ---------------------------------------------------------------------------
  - model: authentik_core.application
    state: present
    identifiers:
      slug: traefik
    attrs:
      name: Traefik
      slug: traefik
      provider: !Find [authentik_providers_proxy.proxyprovider, [name, Traefik Forward Auth]]
      meta_launch_url: !Format ["https://traefik.%s", !Env "DOMAIN"]
      meta_description: Reverse proxy dashboard
      group: Management
      policy_engine_mode: any
      open_in_new_tab: true

  # ---------------------------------------------------------------------------
  # OpenCloud
  # ---------------------------------------------------------------------------
  - model: authentik_core.application
    state: present
    identifiers:
      slug: opencloud
    attrs:
      name: OpenCloud
      slug: opencloud
      provider: !Find [authentik_providers_oauth2.oauth2provider, [name, OpenCloud Provider]]
      meta_launch_url: !Format ["https://cloud.%s", !Env "DOMAIN"]
      meta_description: File sync, sharing, calendar and contacts
      group: Files
      policy_engine_mode: any
      open_in_new_tab: true
